# Cortex Enterprise v3.0 â€” Configuration (reference)
#
# This repo runs as a Node.js relay that can:
# - Accept Slack / Teams / Webhook traffic
# - Route to team agents
# - Optionally call integrations (Jira/GitHub/Confluence/SharePoint)
# - Optionally call external LLMs with budget + classification gating
# - Log audits locally and/or to Supabase
#
# Most settings are configured via environment variables (.env).
# Use this file as a documentation source / template for platform teams.

app:
  port: 3120
  defaultAgent: orchestrator
  projectDirEnv: PROJECT_DIR
  relayDirEnv: RELAY_DIR

integrations:
  github:
    enabled: true
    env:
      token: GITHUB_TOKEN
      webhookSecret: GITHUB_WEBHOOK_SECRET
    features:
      - prs
      - issues
      - workflows
      - codeSearch

  jira:
    enabled: true
    env:
      baseUrl: JIRA_BASE_URL
      email: JIRA_EMAIL
      apiToken: JIRA_API_TOKEN
      oauthToken: JIRA_OAUTH_TOKEN
      webhookSecret: JIRA_WEBHOOK_SECRET
    rateLimit:
      rps: 5

  confluence:
    enabled: true
    env:
      baseUrl: CONFLUENCE_BASE_URL
      email: CONFLUENCE_EMAIL
      apiToken: CONFLUENCE_API_TOKEN

  sharepoint:
    enabled: true
    env:
      graphToken: MS_GRAPH_TOKEN

security:
  rbac:
    enabled: true
    roles:
      - admin
      - manager
      - developer
      - viewer

  classification:
    enabled: true
    externalLLM:
      # external providers are optional; restricted data should not leave boundary
      maxExternalClassification: internal
      maskPiiBeforeExternal: true

  approvals:
    enabled: true
    defaultTimeoutMs: 300000

  audit:
    enabled: true
    jsonlPath: .cortex-relay/logs/audit.jsonl
    supabase:
      enabled: false
      table: audit_log
      env:
        url: SUPABASE_URL
        anonKey: SUPABASE_ANON_KEY
        serviceRoleKey: SUPABASE_SERVICE_ROLE_KEY

llm:
  router:
    enabled: true
    fallbackChain: [anthropic, openai, gemini]
    budget:
      enabled: true
      budgetUsd: 25
    providers:
      anthropic:
        envKey: ANTHROPIC_API_KEY
        envModel: ANTHROPIC_MODEL
      openai:
        envKey: OPENAI_API_KEY
        envModel: OPENAI_MODEL
      gemini:
        envKey: GEMINI_API_KEY
        envModel: GEMINI_MODEL

skills:
  enabled: true
  registryDirEnv: SKILLS_DIR
  outputs:
    - SKILL.md

channels:
  slack:
    enabledIfEnvPresent: [SLACK_BOT_TOKEN, SLACK_APP_TOKEN]
    slashCommand: /cortex
    approvals:
      enabled: true

  teams:
    enabledIfEnvPresent: [MSTEAMS_APP_ID, MSTEAMS_APP_PASSWORD]
    commandPrefix: /cortex

  webhook:
    enabled: true
    env:
      secret: WEBHOOK_SECRET
      genericSecret: GENERIC_WEBHOOK_SECRET
    routes:
      legacy:
        - /message
        - /hooks/*
      new:
        - /webhooks/github
        - /webhooks/jira
        - /webhooks/generic
